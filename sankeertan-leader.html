<!DOCTYPE html>
<html>
  <head>
    <title>Sankeertan</title>
    <style>
      #content {
        width: 80%;
        height: 500px;
        border: 1px solid #ccc;
        overflow-y: auto;
      }
    </style>
  </head>
  <body>
    <textarea id="contentInput" placeholder="Paste content here"></textarea
    ><br />
    <button id="sendContent">Send Content</button><br />
    <div id="content"></div>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
    <script>
      window.addEventListener("load", function () {
        const supabaseUrl = "https://radtpoqypgqetijvopho.supabase.co";
        const supabaseAnonKey ="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJhZHRwb3F5cGdxZXRpanZvcGhvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDE3ODAwNjAsImV4cCI6MjA1NzM1NjA2MH0.dAIWitCyN4TVv3n4PTvhqJlUXsAGVSjOPm-L2jw818k";
        const client = supabase.createClient(supabaseUrl, supabaseAnonKey);
        const channel = client.channel("shared_content");
        const contentInput = document.getElementById("contentInput");
        const sendContentButton = document.getElementById("sendContent");
        const contentDiv = document.getElementById("content");
         // Initial data fetch
         async function fetchInitialData() {
            const { data, error } = await client.from('sankeertan').select('*').eq('id', 1).single();
            if (data) {
                contentDiv.innerHTML = data.content;
                contentDiv.scrollTop = data.scroll_position;
            }
        }
        fetchInitialData();

        sendContentButton.addEventListener('click', async () => {
            await supabase.from('sankeertan').upsert({ id: 1, content: contentInput.value });
            contentDiv.innerHTML = contentInput.value;
            contentInput.value = "";
        });

        contentDiv.addEventListener('scroll', async () => {
            await client.from('sankeertan').upsert({ id: 1, scroll_position: contentDiv.scrollTop });
        });

        client.channel('sankeertan').on('UPDATE', (payload) => {
            if(payload.new.id === 1){
                contentDiv.innerHTML = payload.new.content;
                contentDiv.scrollTop = payload.new.scroll_position;
            }
        }).subscribe();        

      });
    </script>
  </body>
</html>
