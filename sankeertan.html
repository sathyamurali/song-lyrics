<!DOCTYPE html>
<html>
  <head>
    <title>Follower - Sankeertan</title>
    <style>
      #content {
        width: 80%;
        height: 500px;
        border: 1px solid #ccc;
        overflow-y: auto;
      }
    </style>
  </head>
  <body>
    <label><input type="checkbox" id="scrollSync" /> Scroll Sync</label><br />
    <div id="content"></div>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
    <script>
      window.addEventListener("load", function () {
        const supabaseUrl = "https://radtpoqypgqetijvopho.supabase.co";
        const supabaseAnonKey =
          "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJhZHRwb3F5cGdxZXRpanZvcGhvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDE3ODAwNjAsImV4cCI6MjA1NzM1NjA2MH0.dAIWitCyN4TVv3n4PTvhqJlUXsAGVSjOPm-L2jw818k";
        const client = supabase.createClient(supabaseUrl, supabaseAnonKey);
        const contentDiv = document.getElementById("content");
        const scrollSyncCheckbox = document.getElementById("scrollSync");
        // Initial data fetch
        async function fetchInitialData() {
          const { data, error } = await client
            .from("sankeertan")
            .select("*")
            .eq("id", 1)
            .single();
          if (data) {
            contentDiv.innerHTML = data.content;
            contentDiv.scrollTop = data.scroll_position;
          }
        }
        fetchInitialData();

        client
          .channel("sankeertan")
          .on(
            "postgres_changes",
            { event: "UPDATE", schema: "public", table: "sankeertan" },
            (payload) => {
              console.log("Postgres changes payload:", payload);
              // Access payload.new and payload.old
              if (payload.new.id === 1) {
                contentDiv.innerHTML = payload.new.content;
                if (scrollSyncCheckbox && scrollSyncCheckbox.checked) {
                  contentDiv.scrollTop = payload.new.scroll_position;
                } else if (!scrollSyncCheckbox) {
                  contentDiv.scrollTop = payload.new.scroll_position;
                }
              }
            }
          )
          .subscribe();
      });
    </script>
  </body>
</html>
